<html>
  <head>
    <title>DataSheet</title>
    <style>
      table, td, th {
        border-collapse: collapse;
        border: 1px solid #ddd;
        text-align: left;
      }

      .column-name th {
        background-color: #AAAAAA;
        text-align: center;
      }
      .header {
        background-color: #f5f5f5;
      }
      .item th {
        width:75px;
      }
      .item td {
        width:400px;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>DataSheet</h1>
      <p></p>
    </header>
    <p>
      <table id="datasheet">
        <tr class="column-name">
          <th colspan="5">Name</th>
          <th>Value</th>
          <th>Description</th>
        </tr>
      </table>
    </p>

    <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <script>
      var MAX_INDEX = 5;
      var parse = function(data, name, index){
        var split = function(value){
          var size = value.length
          var results = []
          var last_item = value[size - 1];
          if(last_item.match(/^desc:/) === null) {
            results[0] = value;
            results[1] = '';
          } else {
            results[0] = value.slice(0, size - 1);
            results[1] = last_item.substring(5);
          }

          return results;
        }

        if (data[name].constructor === Array) {
          if (data[name][0].constructor === Array){
            // add header
            var tr = $('<tr/>');
            for (var i = 0; i < MAX_INDEX - index; i++) {
              $("<th />").appendTo(tr);
            }
            $("<th class='header' />").attr('colspan', index).text(name).appendTo(tr);
            $("<td class='header' />").appendTo(tr);
            $("<td class='header' />").appendTo(tr);

            $("#datasheet").append(tr);

            // split value and comment.
            for(var i = 0; i < data[name].length; i++) {
              // add header
              var tr = $('<tr/>');
              for (var n = 0; n < MAX_INDEX - index; n++) {
                $("<th />").appendTo(tr);
              }
              $("<th />").attr('colspan', index).appendTo(tr);

              var columns = data[name][i]
              // add value
              $("<td />").text(columns[0]).appendTo(tr);

              // add description
              $("<td />").text(columns[1]).appendTo(tr);

              $("#datasheet").append(tr);            }

            return;
          }
          // add Item

          // add item name
          var tr = $('<tr class="item" />');
          for (var i = 0; i < MAX_INDEX - index; i++) {
            $("<th />").appendTo(tr);
          }
          $("<th />").attr('colspan', index).text(name).appendTo(tr);

          // split value and comment.
          var columns = split(data[name]);

          // add value
          $("<td />").text(columns[0]).appendTo(tr);

          // add description
          $("<td />").text(columns[1]).appendTo(tr);

          $("#datasheet").append(tr);
        } else {
          // add Layer
          // add header
          var tr = $('<tr/>');
          for (var i = 0; i < MAX_INDEX - index; i++) {
            $("<th />").appendTo(tr);
          }
          $("<th class='header' />").attr('colspan', index).text(name).appendTo(tr)
          $("<td class='header' />").appendTo(tr);
          $("<td class='header' />").appendTo(tr);

          $("#datasheet").append(tr);

          // add children
          for (item in data[name]) {
            parse(data[name], item, index - 1);
          }
        }
      }

      $(function(){
        $.getJSON("datasheet.json", function(data){
          console.log(data);
          window.testdata = data;

          for (name in data) {
            if (name === 'Description') {
              $("header p").text(data[name]);
            } else {
              parse(data, name, 5);
            }
          }
        });
      });
    </script>
  </body>
</html>
